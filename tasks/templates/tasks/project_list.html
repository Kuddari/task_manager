{% extends 'base.html' %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}

    {% block title %}
        My Project
    {% endblock %}
    <style>
        /* Hide scrollbar while keeping scrolling functionality */
        .scrollbar-hide {
          -ms-overflow-style: none; /* IE and Edge */
          scrollbar-width: none; /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none; /* Chrome, Safari, and Opera */
        }
    </style>
        
</head>
<body>
    {% block content %}
    <div class="flex flex-row min-h-screen ml-48">
        <div class="w-1/2 bg-slate-700 bg-cover bg-center min-h-screen" style="background-image: url('{% static "images/bg.jpg" %}');">
          
           <div class="pt-8 px-8">
            <!-- Button to trigger popup -->
            <div class="flex justify-end">
                <button onclick="openPopup()" class="py-2 px-4 bg-black bg-opacity-65 backdrop-blur text-white rounded-lg text-xl hover:bg-black hover:bg-opacity-80 hover:scale-105 transition-all duration-400">
                    เพิ่มงาน
                </button>
            </div>

            <!-- Display list of tasks -->
            <style>
                /* Hide scrollbar while keeping scrolling functionality */
                .scrollbar-hide {
                  -ms-overflow-style: none; /* IE and Edge */
                  scrollbar-width: none; /* Firefox */
                }
                .scrollbar-hide::-webkit-scrollbar {
                  display: none; /* Chrome, Safari, and Opera */
                }
            </style>

            <div class="container mt-19 mx-auto px-4">
                <!-- Scrollable Container for Tasks -->
                <div class="max-h-[580px] overflow-y-auto p-4 scrollbar-hide">
                    <div class="flex flex-col gap-4">
                        {% for task in tasks %}
                        <!-- Task Item -->
                        <div class="bg-black bg-opacity-65 backdrop-blur text-white p-4 rounded-lg flex items-center justify-between shadow-md">
                            <!-- Task Details -->
                            <div class="flex flex-col">
                                <span class="text-sm font-medium text-gray-500">Task</span>
                                <span class="text-lg font-semibold">{{ task.title }}</span>
                            </div>
            
                            <!-- Due Date -->
                            <div class="flex flex-col items-center">
                                <span class="text-sm font-medium text-gray-500">Due Date</span>
                                <span class="text-md font-semibold">
                                    {{ task.due_date|date:"d/m/Y"|default:"No Due Date" }}
                                </span>
                            </div>
            
                            <!-- Task Priority -->
                            <div class="flex flex-col items-center">
                                <span class="text-sm font-medium text-gray-500">Priority</span>
                                <span class="text-md font-semibold">
                                    {% if task.priority == 'High' %}
                                    <span class="text-red-500">High</span>
                                    {% elif task.priority == 'Medium' %}
                                    <span class="text-yellow-500">Medium</span>
                                    {% else %}
                                    <span class="text-green-500">Low</span>
                                    {% endif %}
                                </span>
                            </div>
            
                            <!-- Task Status -->
                            <div class="flex flex-col items-center">
                                <span class="text-sm font-medium text-gray-500">Status</span>
                                <div class="flex space-x-2 mt-1">
                                    <!-- To Do -->
                                    {% if task.status == 'to_do' %}
                                    <button 
                                        type="button" 
                                        class="bg-gray-200 text-gray-700 text-xs font-medium px-2 py-1 rounded-full hover:bg-gray-300 transition"
                                    >
                                        To Do
                                    </button>
                                    {% elif task.status == 'in_progress' %}
                                    <!-- In Progress -->
                                    <button 
                                        type="button" 
                                        class="bg-blue-200 text-blue-700 text-xs font-medium px-2 py-1 rounded-full hover:bg-blue-300 transition"
                                    >
                                        In Progress
                                    </button>
                                    {% else %}
                                    <!-- Done -->
                                    <button 
                                        type="button" 
                                        class="bg-green-200 text-green-700 text-xs font-medium px-2 py-1 rounded-full hover:bg-green-300 transition"
                                    >
                                        Done
                                    </button>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                        {% empty %}
                        <!-- Placeholder for No Tasks -->
                        <div class="text-center bg-black bg-opacity-65 backdrop-blur text-white p-4 rounded-lg shadow-md">
                            <h2 class="text-lg font-semibold">ไม่มีงาน</h2>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
        </div> 
            
           

          
   
           <!-- Create New Project Form - Popup Modal -->
           <div id="projectModal" class="z-50 hidden fixed inset-0  bg-gray-500 bg-opacity-25  flex justify-center items-center backdrop-blur">
               <div class="bg-white  opacity-85 backdrop-blur p-6 rounded-lg shadow-lg w-11/12 max-w-2xl ">
                   <div class="flex justify-between">
                       <h3 class="text-lg font-semibold">สร้างงานใหม่</h3>
                       <!-- Close Button -->
                       <button onclick="closePopup()" class="hover:scale-105 transition-all duration-400 hover:bg-red-700 px-4 py-2 bg-red-500 text-white rounded-lg">X</button>
                   </div>
                   <form method="POST" enctype="multipart/form-data" class="space-y-6">
                       {% csrf_token %}
                       
                       <!-- First Name -->
                       <div class="flex flex-col">
                           <label for="name" class="block text-sm font-medium text-black">ชื่อโครงการ</label>
                           <div class="mt-1">
                               <input type="text" id="name"  class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                           </div>
                          
                       </div>
                   
                       <!-- Description -->
                       <div class="flex flex-col">
                           <label for="description" class="block text-sm font-medium text-black">ใส่รายละเอียด</label>
                           <div class="mt-1">
                               <textarea id="description" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="2"></textarea>
                           </div>
                          
                       </div>
                   
                       <!-- Members -->
                       <div class="flex flex-col">
                           <label for="members" class="block text-sm font-medium text-black">ชื่อสมาชิก</label>
                           <div class="mt-1">
                               <select id="members" name="members" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                   <option value="" disabled selected>เลือกสมาชิก</option>  <!-- ตัวเลือกเริ่มต้น -->
                                    <option value="{{ member.id }}">สูไลมาน จะระแอ</option> <!-- member.id คือค่า value และ member.name คือชื่อสมาชิก -->
                               </select>
                           </div>
                       </div>
                   
                      <!-- Start Date -->
                       <div class="flex flex-col">
                           <label for="start_date" class="block text-sm font-medium text-black">วันที่เริ่มต้น</label>
                           <div class="mt-1">
                               <input type="text" id="start_date" placeholder="dd/mm/yyyy" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                           </div>
                       </div>
   
                       <!-- End Date -->
                       <div class="flex flex-col">
                           <label for="end_date" class="block text-sm font-medium text-black">วันที่สิ้นสุด</label>
                           <div class="mt-1">
                               <input type="text" id="end_date" placeholder="dd/mm/yyyy" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                           </div>
                       </div>
                       <div class="flex flex-col">
                           <label class="block text-sm font-medium text-black">สถานะ</label>
                           <div class="mt-1 flex space-x-4">
                               <!-- กำลังทำงาน -->
                               <span id="working" class="cursor-pointer px-4 py-2 rounded-lg border border-gray-300 text-sm text-black hover:bg-gray-100">
                                   กำลังทำงาน
                               </span>
                               
                               <!-- ไม่ทำงาน -->
                               <span id="not_working" class="cursor-pointer px-4 py-2 rounded-lg border border-gray-300 text-sm text-black hover:bg-gray-100">
                                   ไม่ทำงาน
                               </span>
                           </div>
                           <input type="hidden" id="is_active" name="is_active">
                       </div>
                       <!-- Submit Button -->
                       <div class="flex justify-end">
                           <button type="submit" class="hover:scale-105 transition-all duration-400 py-2 px-6 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-200 ease-in-out">
                               ยืนยันการสร้างงาน
                           </button>
                       </div>
                  </form>
                  </div>
            </div>
        </div>
        <div class="flex flex-col col-span-2 justify-center w-1/2 bg-gradient-to-b from-blue-300 to-blue-100">
            <div class="mx-10 flex justify-center gap-12">
                <!-- In Progress -->
                <div 
                    onclick="applyFilter('in_progress')" 
                    class="bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur md:w-48 h-44 2xl:w-56 2xl:h-52 py-3 text-white rounded-3xl cursor-pointer hover:scale-105 transition-transform duration-300"
                >
                    <h1 class="text-center text-[36px] {% if status_filter == 'in_progress' %} text-blue-500 {% endif %}">
                        กำลังทำ
                    </h1>
                    <h1 class="text-center 2xl:mt-6 mt-4 text-[30px] {% if status_filter == 'in_progress' %} text-blue-500 {% endif %}">
                        {{ counts.in_progress }}
                    </h1>
                </div>
            
                <!-- Done -->
                <div 
                    onclick="applyFilter('done')" 
                    class="bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur md:w-56 h-52 2xl:w-64 2xl:h-60 py-3 text-white rounded-3xl cursor-pointer hover:scale-105 transition-transform duration-300"
                >
                    <h1 class="text-center text-[36px] {% if status_filter == 'done' %} text-blue-500 {% endif %}">
                        เสร็จสิ้น
                    </h1>
                    <h1 class="text-center 2xl:mt-12 mt-8 text-[30px] {% if status_filter == 'done' %} text-blue-500 {% endif %}">
                        {{ counts.done }}
                    </h1>
                </div>
            </div>
            
            <div class="mx-10 flex justify-center gap-12 mt-16">
                <!-- Overdue -->
                <div 
                    onclick="applyFilter('overdue')" 
                    class="bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur md:w-56 h-52 2xl:w-64 2xl:h-60 py-3 text-white rounded-3xl cursor-pointer hover:scale-105 transition-transform duration-300"
                >
                    <h1 class="text-center text-[36px] {% if status_filter == 'overdue' %} text-blue-500 {% endif %}">
                        เลยกำหนด
                    </h1>
                    <h1 class="text-center 2xl:mt-12 mt-8 text-[30px] {% if status_filter == 'overdue' %} text-blue-500 {% endif %}">
                        {{ counts.overdue }}
                    </h1>
                </div>
            
                <!-- To Check -->
                <div 
                    onclick="applyFilter('to_check')" 
                    class="bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur md:w-48 h-44 2xl:w-56 2xl:h-52 py-3 text-white rounded-3xl cursor-pointer hover:scale-105 transition-transform duration-300"
                >
                    <h1 class="text-center text-[36px] {% if status_filter == 'to_check' %} text-blue-500 {% endif %}">
                        รอตรวจสอบ
                    </h1>
                    <h1 class="text-center 2xl:mt-6 mt-4 text-[30px] {% if status_filter == 'to_check' %} text-blue-500 {% endif %}">
                        {{ counts.to_check }}
                    </h1>
                </div>
            </div>
            
            

            <div class="mx-12 2xl:mx-44 mt-12 flex justify-center gap-20 text-2xl">
                <button onclick="location.href='{% url 'project_list' %}'"  
                class="w-64 py-3 bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur  text-white rounded-2xl hover:scale-105 transition-all duration-400">โครงการ</button>
                <button  onclick="location.href='{% url 'employee_list' %}'"  
                 class="w-56 py-3 bg-gradient-to-b from-blue-400 drop-shadow-md shadow-md shadow-blue-500 bg-backdrop-blur  text-white rounded-2xl hover:scale-105 transition-all duration-400">บุคลากร</button>
            </div>

        </div>
    </div>
    
    <script>
        function applyFilter(status) {
            const queryParams = new URLSearchParams(window.location.search);
            const currentStatus = queryParams.get('status');
    
            // If the clicked status is already selected, reset to default (clear the filter)
            if (currentStatus === status) {
                queryParams.delete('status'); // Remove the status parameter
            } else {
                queryParams.set('status', status); // Set the status parameter
            }
    
            window.location.search = queryParams.toString(); // Refresh the page with the updated filter
        }
    </script>
    
    
    <script>
        // JavaScript สำหรับเพิ่มเอฟเฟกต์การนับเลข
        document.addEventListener('DOMContentLoaded', function () {
            const counters = document.querySelectorAll('[data-target]'); // ค้นหากล่องที่มี data-target
    
            counters.forEach(counter => {
                const updateCount = () => {
                    const target = +counter.getAttribute('data-target'); // แปลงค่า target เป็นตัวเลข
                    const current = +counter.innerText; // ดึงค่าปัจจุบันในกล่อง
                    const increment = target / 100; // แบ่งการเพิ่มเป็น 100 ส่วน
    
                    if (current < target) {
                        counter.innerText = Math.ceil(current + increment); // เพิ่มค่าปัจจุบัน
                        setTimeout(updateCount, 30); // เรียกฟังก์ชันซ้ำทุก 30ms
                    } else {
                        counter.innerText = target; // หากถึงเป้าหมายแล้ว ตั้งค่าเป็นเป้าหมาย
                    }
                };
    
                updateCount(); // เริ่มฟังก์ชันนับเลข
            });
        });
    </script>

        <!-- Move the script to the bottom of the body -->
        <script>
           // Function to open the popup
            function openPopup() {
                document.getElementById('projectModal').classList.remove('hidden');
                document.getElementById('sidebar').classList.add('backdrop-blur'); // ทำให้ sidebar เบลอ
            }

            // Function to close the popup
            function closePopup() {
                document.getElementById('projectModal').classList.add('hidden');
                document.getElementById('sidebar').classList.remove('backdrop-blur'); // เอาฟิลเตอร์เบลอออกจาก sidebar
            }
        </script>

       <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Flatpickr สำหรับวันที่เริ่มต้น
            flatpickr("#start_date", {
                locale: "th", // ใช้ภาษาไทย
                dateFormat: "d/m/Y", // ใช้รูปแบบ dd/mm/yyyy
                onChange: function(selectedDates, dateStr, instance) {
                    // เมื่อเลือกวันที่เริ่มต้นแล้ว ปรับปรุง minDate สำหรับวันที่สิ้นสุด
                    document.getElementById('end_date')._flatpickr.set('minDate', selectedDates[0]);
                }
            });
    
            // Flatpickr สำหรับวันที่สิ้นสุด
            flatpickr("#end_date", {
                locale: "th", // ใช้ภาษาไทย
                dateFormat: "d/m/Y", // ใช้รูปแบบ dd/mm/yyyy
            });
        });
    </script>
   <script>
    // การกำหนดค่าให้เลือก
    const workingOption = document.getElementById('working');
    const notWorkingOption = document.getElementById('not_working');
    const hiddenInput = document.getElementById('is_active');

    // ฟังก์ชันเปลี่ยนสถานะเมื่อเลือกตัวใดตัวหนึ่ง
    function selectOption(selected) {
        if (selected === 'working') {
            workingOption.classList.add('bg-blue-500', 'text-white');
            notWorkingOption.classList.remove('bg-blue-500', 'text-white');
            hiddenInput.value = 'working'; // กำหนดค่าให้ hidden input
        } else if (selected === 'not_working') {
            notWorkingOption.classList.add('bg-blue-500', 'text-white');
            workingOption.classList.remove('bg-blue-500', 'text-white');
            hiddenInput.value = 'not_working'; // กำหนดค่าให้ hidden input
        }
    }

    // การคลิกที่ "กำลังทำงาน"
    workingOption.addEventListener('click', function() {
        selectOption('working');
    });

    // การคลิกที่ "ไม่ทำงาน"
    notWorkingOption.addEventListener('click', function() {
        selectOption('not_working');
    });
</script>
    {% endblock %}


</body>
</html>
